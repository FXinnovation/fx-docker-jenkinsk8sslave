#!/bin/bash
set -e -x
###
# Making sure curl is installed
###
apt-get update
apt-get install -y curl
###
# Installing Docker
###
# Making sure docker is not installed
apt-get purge "lxc-docker*" || true
apt-get purge "docker.io*" || true
# Installing some docker dependencies
apt-get install -y \
  apt-transport-https \
  ca-certificates \
  gnupg2
# Adding key for docker debian repository
apt-key adv \
  --keyserver hkp://ha.pool.sks-keyservers.net:80 \
  --recv-keys 58118E89F3A912897C070ADBF76221572C52609D
echo "deb https://apt.dockerproject.org/repo debian-jessie main" > /etc/apt/sources.list.d/docker.list
# Updating repo list
apt-get update
# Installing docker package
apt-get install -y \
  docker-engine=${DOCKER_VERSION}
###
# Installing Terraform
###
curl https://releases.hashicorp.com/terraform/${TERRAFORM_VERSION}/terraform_${TERRAFORM_VERSION}_linux_amd64.zip > terraform_${TERRAFORM_VERSION}_linux_amd64.zip
unzip terraform_${TERRAFORM_VERSION}_linux_amd64.zip -d /usr/bin
rm -f terraform_${TERRAFORM_VERSION}_linux_amd64.zip
###
# Installing Packer
###
curl "https://releases.hashicorp.com/packer/${PACKER_VERSION}/packer_${PACKER_VERSION}_linux_amd64.zip" -o /tmp/packer.zip
unzip /tmp/packer.zip -d /usr/bin
rm -f /tmp.packer.zip
###
# Cleaning Image
###
apt-get clean
# TODO There is probably more cleaning to do here
